services:
    _defaults:
        autowire: false
        autoconfigure: false
        public: false

    MangoSylius\ExtendedChannelsPlugin\Service\SwiftMailerAdapter:
        decorates: sylius.email_sender.adapter.swiftmailer
        arguments:
            $dispatcher: '@event_dispatcher'
            $mailer: '@mailer'
            $logger: '@logger'

    MangoSylius\ExtendedChannelsPlugin\Service\OrderEmailManager:
        decorates: sylius.email_manager.order
        arguments:
            $emailSender: '@sylius.email_sender'
            $channelContext: '@sylius.context.channel'


    MangoSylius\ExtendedChannelsPlugin\Form\Extension\ExtendedChannelExtension:
        tags:
            - name: form.type_extension
              extended_type: Sylius\Bundle\ChannelBundle\Form\Type\ChannelType

    MangoSylius\ExtendedChannelsPlugin\Form\Extension\ProductExtension:
        tags:
            - name: form.type_extension
              extended_type: Sylius\Bundle\ProductBundle\Form\Type\ProductType

    MangoSylius\ExtendedChannelsPlugin\Form\Extension\ProductVariantExtension:
        tags:
            -   name: form.type_extension
                extended_type: Sylius\Bundle\ProductBundle\Form\Type\ProductVariantType

    sylius.email_manager.order: '@MangoSylius\ExtendedChannelsPlugin\Service\OrderEmailManager'
    Sylius\Bundle\ShopBundle\EmailManager\OrderEmailManagerInterface: '@MangoSylius\ExtendedChannelsPlugin\Service\OrderEmailManager'

    MangoSylius\ExtendedChannelsPlugin\Command\UpdateProductPriceByExchangeRatesCommand:
        tags:
            - name: 'console.command'
        arguments:
            $entityManager: '@doctrine.orm.default_entity_manager'
            $logger: '@sylius_fixtures.logger'
            $exchangeRateRepository: '@sylius.repository.exchange_rate'
            $productVariantRepository: '@sylius.repository.product_variant'
            $channelRepository: '@sylius.repository.channel'
            $currencyConverter: '@sylius.currency_converter'

    MangoSylius\ExtendedChannelsPlugin\Command\UpdateExchangeRatesCommand:
        tags:
            - name: 'console.command'
        arguments:
            $entityManager: '@doctrine.orm.default_entity_manager'
            $logger: '@sylius_fixtures.logger'
            $exchangeRateRepository: '@sylius.repository.exchange_rate'

    MangoSylius\ExtendedChannelsPlugin\Service\MangoUnpaidOrdersStateUpdater:
        arguments:
            $orderRepository: '@sylius.repository.order'
            $stateMachineFactory: '@sm.factory'
            $expirationPeriod: '%sylius_order.order_expiration_period%'
            $expirationMethodCodes: '%sylius_order.expiration_method_codes%'

    MangoSylius\ExtendedChannelsPlugin\Command\MangoCancelUnpaidOrdersCommand:
        tags:
            - name: 'console.command'
        arguments:
            $unpaidCartsStateUpdater: '@MangoSylius\ExtendedChannelsPlugin\Service\MangoUnpaidOrdersStateUpdater'
            $entityManager: '@doctrine.orm.default_entity_manager'
            $expirationPeriod: '%sylius_order.order_expiration_period%'
            $expirationMethodCodes: '%sylius_order.expiration_method_codes%'

    MangoSylius\ExtendedChannelsPlugin\Menu\AdminMenuListener:
        tags:
            - name: kernel.event_listener
              event: sylius.menu.admin.order.show
              method: addButtonsToOrder

            - name: kernel.event_listener
              event: sylius.menu.admin.product.update
              method: addButtonsToProduct

    MangoSylius\ExtendedChannelsPlugin\Controller\ResendOrderConfirmation:
        public: true
        arguments:
            $router: '@router'
            $flashBag: '@session.flash_bag'
            $translator: '@translator'
            $emailSender: '@sylius.email_sender'
            $orderRepository: '@sylius.repository.order'

    MangoSylius\ExtendedChannelsPlugin\Controller\DuplicateController:
        public: true
        arguments:
            $eventDispatcher: '@event_dispatcher'
            $router: '@router'
            $flashBag: '@session.flash_bag'
            $translator: '@translator'
            $productRepository: '@sylius.repository.product'
            $productVariantRepository: '@sylius.repository.product_variant'
            $productDuplicator: '@MangoSylius\ExtendedChannelsPlugin\Service\ProductDuplicator'

    MangoSylius\ExtendedChannelsPlugin\Service\ProductDuplicator:
        arguments:
            $imageUploader: '@sylius.image_uploader'
            $productRepository: '@sylius.repository.product'
            $productVariantRepository: '@sylius.repository.product_variant'
            $dataManager: '@liip_imagine.data.manager'
